!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Adjust=t():e.Adjust=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t,n){var r=n(2);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}},function(e,t,n){var r=n(5),o=n(14),i=n(6);e.exports=function(e,t){return r(e)||o(e,t)||i()}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){(function(t,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var r;r=function(){"use strict";function e(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,i=void 0,a=void 0,u=function(e,t){p[o]=e,p[o+1]=t,2===(o+=2)&&(a?a(v):w())},s="undefined"!=typeof window?window:void 0,c=s||{},l=c.MutationObserver||c.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){var e=setTimeout;return function(){return e(v,1)}}var p=new Array(1e3);function v(){for(var e=0;e<o;e+=2)(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0;o=0}var h,g,y,b,w=void 0;function k(e,t){var n=this,r=new this.constructor(S);void 0===r[x]&&M(r);var o=n._state;if(o){var i=arguments[o-1];u(function(){return R(o,r,i,n._result)})}else E(n,r,e,t);return r}function P(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(S);return I(t,e),t}f?w=function(){return t.nextTick(v)}:l?(g=0,y=new l(v),b=document.createTextNode(""),y.observe(b,{characterData:!0}),w=function(){b.data=g=++g%2}):d?((h=new MessageChannel).port1.onmessage=v,w=function(){return h.port2.postMessage(0)}):w=void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(v)}:m()}catch(e){return m()}}():m();var x=Math.random().toString(36).substring(2);function S(){}var N=void 0,O=1,_=2;function j(t,n,r){n.constructor===t.constructor&&r===k&&n.constructor.resolve===P?function(e,t){t._state===O?T(e,t._result):t._state===_?D(e,t._result):E(t,void 0,function(t){return I(e,t)},function(t){return D(e,t)})}(t,n):void 0===r?T(t,n):e(r)?function(e,t,n){u(function(e){var r=!1,o=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?I(e,n):T(e,n))},function(t){r||(r=!0,D(e,t))},e._label);!r&&o&&(r=!0,D(e,o))},e)}(t,n,r):T(t,n)}function I(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(o=typeof(r=t),null===r||"object"!==o&&"function"!==o)T(e,t);else{var n=void 0;try{n=t.then}catch(t){return void D(e,t)}j(e,t,n)}var r,o}function A(e){e._onerror&&e._onerror(e._result),C(e)}function T(e,t){e._state===N&&(e._result=t,e._state=O,0!==e._subscribers.length&&u(C,e))}function D(e,t){e._state===N&&(e._state=_,e._result=t,u(A,e))}function E(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+O]=n,o[i+_]=r,0===i&&e._state&&u(C,e)}function C(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?R(n,r,o,i):o(i);e._subscribers.length=0}}function R(t,n,r,o){var i=e(r),a=void 0,u=void 0,s=!0;if(i){try{a=r(o)}catch(e){s=!1,u=e}if(n===a)return void D(n,new TypeError("A promises callback cannot return that same promise."))}else a=o;n._state!==N||(i&&s?I(n,a):!1===s?D(n,u):t===O?T(n,a):t===_&&D(n,a))}var L=0;function M(e){e[x]=L++,e._state=void 0,e._result=void 0,e._subscribers=[]}var B=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(S),this.promise[x]||M(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&T(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===N&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===P){var o=void 0,i=void 0,a=!1;try{o=e.then}catch(e){a=!0,i=e}if(o===k&&e._state!==N)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===q){var u=new n(S);a?D(u,i):j(u,e,o),this._willSettleAt(u,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===N&&(this._remaining--,e===_?D(r,n):this._result[t]=n),0===this._remaining&&T(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;E(e,void 0,function(e){return n._settledAt(O,t,e)},function(e){return n._settledAt(_,t,e)})},e}(),q=function(){function t(e){this[x]=L++,this._result=this._state=void 0,this._subscribers=[],S!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){I(e,t)},function(t){D(e,t)})}catch(t){D(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return e(t)?this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return q.prototype.then=k,q.all=function(e){return new B(this,e).promise},q.race=function(e){var t=this;return r(e)?new t(function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},q.resolve=P,q.reject=function(e){var t=new this(S);return D(t,e),t},q._setScheduler=function(e){a=e},q._setAsap=function(e){u=e},q._asap=u,q.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=q},q.Promise=q,q},e.exports=r()}).call(this,n(12),n(13))},function(e,t,n){var r=n(15),o=n(7),i=n(16);e.exports=function(e){return r(e)||o(e)||i()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t,n){var r=n(11);e.exports=function(e,t){if(null==e)return{};var n,o,i=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t,n){var r=n(5),o=n(7),i=n(6);e.exports=function(e){return r(e)||o(e)||i()}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,c=[],l=!1,f=-1;function d(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&m())}function m(){if(!l){var e=u(d);l=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||u(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"isSupported",function(){return Xe}),n.d(r,"getAll",function(){return at}),n.d(r,"getFirst",function(){return ut}),n.d(r,"getItem",function(){return st}),n.d(r,"filterBy",function(){return ct}),n.d(r,"addItem",function(){return lt}),n.d(r,"addBulk",function(){return ft}),n.d(r,"updateItem",function(){return dt}),n.d(r,"deleteItem",function(){return mt}),n.d(r,"deleteBulk",function(){return pt}),n.d(r,"trimItems",function(){return vt}),n.d(r,"count",function(){return ht}),n.d(r,"clear",function(){return gt}),n.d(r,"destroy",function(){return yt});var o={};n.r(o),n.d(o,"isSupported",function(){return wt}),n.d(o,"getAll",function(){return jt}),n.d(o,"getFirst",function(){return It}),n.d(o,"getItem",function(){return At}),n.d(o,"filterBy",function(){return Tt}),n.d(o,"addItem",function(){return Dt}),n.d(o,"addBulk",function(){return Et}),n.d(o,"updateItem",function(){return Ct}),n.d(o,"deleteItem",function(){return Rt}),n.d(o,"deleteBulk",function(){return Lt}),n.d(o,"trimItems",function(){return Mt}),n.d(o,"count",function(){return Bt}),n.d(o,"clear",function(){return qt}),n.d(o,"destroy",function(){return Ft});var i=n(0),a=n.n(i),u=n(8),s=n.n(u),c=n(1),l=n.n(c),f=n(4),d=n.n(f),m=1e3,p=60*m,v=60*p,h=24*v,g="general",y="gdpr",b=n(2),w=n.n(b),k=n(9),P=n.n(k);function x(e){return!Object.keys(e).length&&e.constructor===Object}function S(e){return"object"===P()(e)&&null!==e&&!(e instanceof Array)}function N(e){try{return S(JSON.parse(e))}catch(e){return!1}}function O(e,t,n){function r(e){return t instanceof Array?t.every(function(t){return e[t]===n[t]}):e[t]===n}for(var o=0;o<e.length;o+=1)if(r(e[o]))return o;return-1}function _(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t){return a()({},e,w()({},t.key,t.value))},{})}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.filter(function(e){return-1!==t.indexOf(e)})}function I(e,t){return new RegExp("\\/".concat(t,"(\\/.*|\\?.*){0,1}$")).test(e)}function A(e,t){var n=l()(t,2),r=n[0],o=n[1];return a()({},e,w()({},r,o))}function T(e,t){var n={entries:function(t){return[t,e[t]]},values:function(t){return e[t]}};return Object[t]?Object[t](e):Object.keys(e).map(n[t])}function D(e){return T(e,"entries")}var E,C=n(10),R=n.n(C),L="error",M=(E={},w()(E,"none",-1),w()(E,L,0),w()(E,"info",1),w()(E,"verbose",2),E),B={development:"verbose",production:L,test:"verbose"},q=[{name:"log",level:"verbose"},{name:"info",level:"info"},{name:"error",level:L}],F=G(),K="";function G(){return B.production||L}function U(e){for(var t=(new Date).toISOString(),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=["[".concat(ee.namespace,"]"),t,"".concat(e.toUpperCase(),":")].concat(r),a=K?document.querySelector(K):null;if(console[e].apply(null,i),a){var u=R()(i),s=u[0],c=u[1],l=u[2],f=u.slice(3),d="log"===e?"  ":"info"===e?" ":"";a.textContent+="".concat(s," ").concat(c," ").concat(l).concat(d," ").concat(f.map(function(e){return S(e)?JSON.stringify(e):e}).join(" "),"\n"),a.scrollTop=a.scrollHeight}}var W={setLogLevel:function(e,t){e&&-1===Object.keys(M).indexOf(e)?U("error","You must set one of the available log levels: verbose, info, error or none"):(F=e||G(),K=t,U("info","Log level set to ".concat(F)))}};q.forEach(function(e){Object.defineProperty(W,e.name,{writable:!1,value:function(){if(M[F]>=M[e.level]){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];U.apply(void 0,[e.name].concat(n))}}})});var Y=W,H={},J={},z=["appToken","environment"],V=[].concat(z,["defaultTracker"]),X=["customUrl","eventDeduplicationListLimit"],Z={namespace:"adjust-sdk",version:"5.0.0",sessionWindow:30*p,sessionTimerWindow:60*m,requestValidityWindow:28*h,baseUrl:{app:"https://app.adjust.com",gdpr:"https://gdpr.adjust.com"}};function $(e){var t=z.filter(function(t){return!e[t]});return!!t.length&&(Y.error("You must define ".concat(function(e){if(!e.length)return"";if(1===e.length)return e[0];var t=e.length-1,n=e.slice(0,t).join(", ");return"".concat(n," and ").concat(e[t])}(t))),!0)}var Q,ee=a()({},Z,{set:function(e){if(!$(e)){var t=[].concat(d()(V),X).filter(function(t){return!!e[t]}).map(function(t){return[t,e[t]]});H=t.filter(function(e){var t=l()(e,1)[0];return-1!==V.indexOf(t)}).reduce(A,{}),J=t.filter(function(e){var t=l()(e,1)[0];return-1!==X.indexOf(t)}).reduce(A,{})}},getBaseParams:function(){return a()({},H)},getCustomConfig:function(){return a()({},J)},isInitialised:function(){return z.reduce(function(e,t){return e&&!!H[t]},!0)},hasMissing:$,destroy:function(){H={},J={}}}),te={queue:{name:"q",scheme:{keyPath:"timestamp",autoIncrement:!1,fields:{url:{key:"u",values:{"/session":1,"/event":2,"/gdpr_forget_device":3}},method:{key:"m",values:{GET:1,POST:2,PUT:3,DELETE:4}},timestamp:{key:"t"},params:{key:"p",keys:{createdAt:"ca",timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastInterval:"li",eventToken:"et",revenue:"re",currency:"cu",callbackParams:"cp",partnerParams:"pp"}}}}},activityState:{name:"as",scheme:{keyPath:"uuid",autoIncrement:!1,fields:{uuid:{key:"u",values:{unknown:"-"}},timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastActive:"la",lastInterval:"li",installed:{key:"in",values:{false:0,true:1}},attribution:{key:"at",keys:{adid:"a",tracker_token:"tt",tracker_name:"tn",network:"nt",campaign:"cm",adgroup:"ag",creative:"cr",click_label:"cl",state:{key:"st",values:{installed:1,reattributed:2}}}}}}},globalParams:{name:"gp",scheme:{keyPath:"keyType",autoIncrement:!1,index:"type",fields:{keyType:{key:"kt",composite:["key","type"]},key:"k",value:"v",type:{key:"t",values:{callback:1,partner:2}}}}},eventDeduplication:{name:"ed",scheme:{keyPath:"internalId",autoIncrement:!0,fields:{internalId:"ii",id:"i"}}},disabled:{name:"d",scheme:{keyPath:"reason",fields:{reason:{key:"r",values:(Q={},w()(Q,g,1),w()(Q,y,2),Q)},pending:{key:"p",values:{false:0,true:1}}}},permanent:!0}};function ne(e){try{return JSON.parse(e)}catch(t){return e}}function re(e,t,n){var r,o=n.values?{values:(r=n.values,D(r).map(function(e){var t=l()(e,2),n=t[0];return[t[1],ne(n)]}).reduce(A,{}))}:{},i=n.keys?{keys:oe(e,n.keys)}:{},u=n.composite?{composite:n.composite.map(function(t){return ie(e,t)})}:{};return a()({key:t},o,{},i,{},u)}function oe(e,t){return D(t).map(function(t){var n=l()(t,2),r=n[0],o=n[1];return o.key?[o.key,re(e,r,o)]:[o,r]}).reduce(A,{})}function ie(e,t){var n=te[e].scheme.fields[t];return n?n.key||n:t}var ae,ue=D(te).map(function(e){var t=l()(e,2),n=t[0],r=t[1];return[n,{keyPath:r.scheme.keyPath,autoIncrement:r.scheme.autoIncrement,index:r.scheme.index,fields:r.scheme.fields}]}).reduce(A,{}),se=D(ue).map(function(e){var t=l()(e,2),n=t[0],r=t[1];return[n,{keyPath:ie(n,r.keyPath),autoIncrement:r.autoIncrement,index:ie(n,r.index),fields:oe(n,r.fields)}]}).reduce(A,{}),ce=D(te).reduce(function(e,t){var n=l()(t,2)[1];return e.concat(n.scheme.fields)},[]).map(function(e){return D(e).filter(function(e){return l()(e,2)[1].values}).map(function(e){return D(l()(e,2)[1].values)}).reduce(function(e,t){return e.concat(t)},[])}).reduce(function(e,t){return e.concat(t)},[]).reduce(A,{}),le=D(te).map(function(e){var t=l()(e,2),n=t[0],r=t[1];return[n,{name:r.name,permanent:r.permanent}]}).reduce(A,{}),fe={left:ue,right:se,values:ce,storeNames:{left:le,right:(ae=le,D(ae).map(function(e){var t=l()(e,2),n=t[0],r=t[1];return[r.name,{name:n,permanent:r.permanent}]}).reduce(A,{}))}};function de(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e+"",r=1;r<=t;r+=1)e<Math.pow(10,r)&&(n="0".concat(n));return n}function me(e){var t=e?new Date(e):new Date,n=function(e){var t=de(e.getDate()),n=de(e.getMonth()+1);return[e.getFullYear(),n,t].join("-")}(t),r=function(e){var t=de(e.getHours(),1),n=de(e.getMinutes()),r=de(e.getSeconds()),o=de(e.getMilliseconds(),2);return[t,n,r].join(":")+"."+o}(t),o=function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+de(Math.floor(Math.abs(t)/60))+de(Math.abs(t)%60)}(t);return"".concat(n,"T").concat(r,"Z").concat(o)}function pe(e,t){return isNaN(e)||isNaN(t)?0:Math.abs(t-e)}var ve={},he=!1,ge=!1;function ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ve=he?a()({},e):{}}function be(){he&&(ve.lastInterval=function(){var e=ve.lastActive;if(e)return Math.round(pe(e,Date.now())/m);return-1}(),ve.lastActive=Date.now())}function we(e){ve=a()({},ve,{},e)}function ke(){ge=!0}function Pe(){var e=ve.lastActive;return Math.round(pe(e,Date.now())/m)}function xe(){return(ve.timeSpent||0)+(ge?Pe():0)}function Se(){var e=pe(ve.lastActive,Date.now())<ee.sessionWindow,t=ge||!ge&&e;return(ve.sessionLength||0)+(t?Pe():0)}function Ne(){he&&(we({timeSpent:xe(),sessionLength:Se()}),be())}var Oe={get current(){return he?a()({},ve):{}},set current(e){return ye(e)},init:function(e){he=!0,ye(e)},isStarted:function(){return he},toForeground:ke,toBackground:function(){ge=!1},initParams:function(){Ne(),ke()},getParams:function(){if(!he)return{};var e=ve.lastInterval>=0?ve.lastInterval:0;return{timeSpent:ve.timeSpent||0,sessionLength:ve.sessionLength||0,sessionCount:ve.sessionCount||1,lastInterval:e||0}},updateParams:function(e,t){if(he){var n={};n.timeSpent=xe(),n.sessionLength=Se(),I(e,"session")&&(n.sessionCount=(ve.sessionCount||0)+1),I(e,"event")&&(n.eventCount=(ve.eventCount||0)+1),we(n),t||be()}},updateInstalled:function(){he&&(ve.installed||we({installed:!0}))},updateSessionOffset:Ne,updateSessionLength:function(){he&&(we({sessionLength:Se()}),be())},resetSessionOffset:function(){he&&we({timeSpent:0,sessionLength:0})},updateLastActive:be,destroy:function(){ve={},he=!1,ge=!1}},_e={},je=[];function Ie(e,t){var n="id"+Math.random().toString(36).substr(2,16);return _e[e]||(_e[e]=[]),_e[e].push({id:n,cb:t}),n}function Ae(e,t){if(!_e[e])return[];_e[e].forEach(function(n){"function"==typeof n.cb&&je.push(setTimeout(function(){return n.cb(e,t)}))})}function Te(e,t){return e&&void 0!==e[t]?e[t]:t}function De(e){var t=e.storeName,n=e.dir,r=e.record,o=e.scheme;if(r)return o=o||fe[n][Le({storeName:t,dir:"right"})].fields,D(r).map(function(e){var r=l()(e,2),i=r[0],a=r[1];return function(e){var t=e.storeName,n=e.scheme,r=e.dir,o=e.key,i=e.value;if(!n)return[o,i];var a=n.key||n;return S(i)?[a,De({storeName:t,dir:r,record:i,scheme:n.keys})]:[a,Te(n.values,i)]}({storeName:t,scheme:o[i],dir:n,key:i,value:a})}).reduce(function(e,t){var n=l()(t,2),r=n[0],o=n[1];return a()({},e,w()({},r,o))},{})}function Ee(e){var t=e.storeName,n=e.dir,r=e.records;return(void 0===r?[]:r).map(function(e){return De({storeName:t,dir:n,record:e})})}function Ce(e){var t=e.storeName,n=e.dir,r=e.target,o=fe[n][Le({storeName:t,dir:"right"})],i=o.fields[o.keyPath],a=r instanceof Array?r.slice():[r],u=(i.composite||[o.keyPath]).map(function(e,t){return Te(o.fields[e].values,a[t])});return 1===u.length?u[0]:u}function Re(e){return fe.values[e]||e}function Le(e){var t=e.storeName,n=e.dir;return(fe.storeNames[n][t]||{}).name||t}function Me(e){var t=e.storeName,n=e.error;return{name:n.name,message:n.message.replace('"'.concat(t,'"'),Le({storeName:t,dir:"right"}))}}var Be=ee.namespace,qe=fe.storeNames.left;var Fe={storeNames:qe,stores:{},clear:function(){D(qe).forEach(function(e){var t=l()(e,2)[1];t.permanent||localStorage.removeItem("".concat(Be,".").concat(t.name))})}};D(qe).forEach(function(e){var t=l()(e,2)[1];Object.defineProperty(Fe.stores,t.name,{get:function(){return e=t.name,((n=JSON.parse(localStorage.getItem("".concat(Be,".").concat(e))))instanceof Array?n:De({storeName:"disabled",dir:"right",record:n}))||null;var e,n},set:function(e){return function(e,t){t?localStorage.setItem("".concat(Be,".").concat(e),JSON.stringify(t instanceof Array?t:De({storeName:"disabled",dir:"left",record:t}))):localStorage.removeItem("".concat(Be,".").concat(e))}(t.name,e)}})}),Object.freeze(Fe.stores);var Ke=Fe,Ge=Ke.storeNames.disabled.name,Ue=Ke.stores[Ge];var We={reload:function(){var e=Ke.stores[Ge];e&&!Ue&&Ae("sdk:shutdown",!0),Ue=e},recover:function(){Ke.stores[Ge]||(Ke.stores[Ge]=Ue)}};Object.defineProperty(We,"disabled",{get:function(){return Ue||(Ue=Ke.stores[Ge]),Ue?a()({},Ue):null},set:function(e){return function(e){Ke.stores[Ge]=e,Ue=e?a()({},e):null}(e)}});var Ye,He=We,Je="undefined"==typeof Promise?n(3).Promise:Promise,ze=ee.namespace,Ve=1;function Xe(){var e=Ze(),t=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),n=!!e&&!t;return n||Y.error("IndexedDB is not supported in this browser"),n}function Ze(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}function $e(){var e=Ze();return Xe()?new Je(function(t,n){if(Ye)t({success:!0});else{var r=e.open(ze,Ve);r.onupgradeneeded=function(e){return function(e,t){var n=e.target.result;e.target.transaction.onerror=t,e.target.transaction.onabort=t;var r=fe.storeNames.left,o=Oe.current||{},i=o&&!x(o);D(r).filter(function(e){return!l()(e,2)[1].permanent}).forEach(function(e){var t=l()(e,2),a=t[0],u=t[1],s=fe.right[a],c=n.createObjectStore(u.name,{keyPath:s.keyPath,autoIncrement:s.autoIncrement||!1});s.index&&c.createIndex("".concat(s.index,"Index"),s.index),u.name===r.activityState.name&&i?(c.add(De({storeName:a,record:o,dir:"left"})),Y.info("Activity state has been recovered")):Ke.stores[u.name]&&(Ke.stores[u.name].forEach(function(e){return c.add(e)}),Y.info("Migration from localStorage done for ".concat(a," store")))}),He.recover(),Ke.clear()}(e,n)},r.onsuccess=function(e){return function(e,t){Ye=e.target.result,t({success:!0}),Ye.onclose=yt}(e,t)},r.onerror=n}}):Je.reject({name:"IDBNotSupported",message:"IndexedDB is not supported"})}function Qe(e,t){var n,r=e.storeName,o=e.mode,i=Ye.transaction([r],o),a=i.objectStore(r),u=fe.right[Le({storeName:r,dir:"right"})];return u.index&&(n=a.index("".concat(u.index,"Index"))),i.onerror=t,i.onabort=t,{transaction:i,store:a,index:n,options:u}}function et(e,t){var n=t.target.error;return e({name:n.name,message:n.message})}function tt(e){return e.fields[e.keyPath].composite||null}function nt(e,t,n){var r=-1!==["add","put"].indexOf(n),o=tt(e);return o?r?a()(w()({},e.keyPath,o.map(function(e){return t[e]}).join("")),t):t?t.join(""):null:t}function rt(e,t){var n=tt(e);return n&&S(t)?n.map(function(e){return t[e]}):null}function ot(e){var t=e.storeName,n=e.target,r=void 0===n?null:n,o=e.action,i=e.mode,a=void 0===i?"readonly":i;return $e().then(function(){return new Je(function(e,n){var i=Qe({storeName:t,mode:a},n),u=i.store,s=i.options,c=u[o](nt(s,r,o)),l=rt(s,r);c.onsuccess=function(){"get"!==o||c.result?e(l||c.result||r):n({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(t,'" store')})},c.onerror=function(e){return et(n,e)}})})}function it(e){var t=e.storeName,n=e.action,r=void 0===n?"list":n,o=e.range,i=void 0===o?null:o,a=e.firstOnly,u=e.mode,s=void 0===u?"readonly":u;return $e().then(function(){return new Je(function(e,n){var o=Qe({storeName:t,mode:s},n),u=o.transaction,c=o.store,l=o.index,f=o.options,d=(l||c).openCursor(i),m=[];u.oncomplete=function(){return e(a?m[0]:m)},d.onsuccess=function(e){var t=e.target.result;t&&("delete"===r?(t.delete(),m.push(rt(f,t.value)||t.value[f.keyPath])):m.push(t.value),a||t.continue())},d.onerror=function(e){return et(n,e)}})})}function at(e,t){return it({storeName:e,firstOnly:t})}function ut(e){return at(e,!0)}function st(e,t){return ot({storeName:e,target:t,action:"get"})}function ct(e,t){return it({storeName:e,range:IDBKeyRange.only(t)})}function lt(e,t){return ot({storeName:e,target:t,action:"add",mode:"readwrite"})}function ft(e,t,n){return function(e){var t=e.storeName,n=e.target,r=e.action,o=e.mode;return $e().then(function(){return new Je(function(e,i){if(!n||n&&!n.length)return i({name:"NoTargetDefined",message:"No array provided to perform ".concat(r,' bulk operation into "').concat(t,'" store')});var a=Qe({storeName:t,mode:o},i),u=a.transaction,s=a.store,c=a.options,l=[],f=n[0];u.oncomplete=function(){return e(l)},function e(t){t.onerror=function(e){return et(i,e)};t.onsuccess=function(){l.push(rt(c,f)||t.result),f=n[l.length],l.length<n.length&&e(s[r](nt(c,f,r)))}}(s[r](nt(c,f,r)))})})}({storeName:e,target:t,action:n?"put":"add",mode:"readwrite"})}function dt(e,t){return ot({storeName:e,target:t,action:"put",mode:"readwrite"})}function mt(e,t){return ot({storeName:e,target:t,action:"delete",mode:"readwrite"})}function pt(e,t,n){return it({storeName:e,action:"delete",range:n?IDBKeyRange[n](t):IDBKeyRange.only(t),mode:"readwrite"})}function vt(e,t){var n=fe.right[Le({storeName:e,dir:"right"})];return at(e).then(function(e){return e.length?e[t-1]:null}).then(function(t){return t?pt(e,t[n.keyPath],"upperBound"):[]})}function ht(e){return $e().then(function(){return new Je(function(t,n){var r=Qe({storeName:e,mode:"readonly"},n).store.count();r.onsuccess=function(){return t(r.result)},r.onerror=function(e){return et(n,e)}})})}function gt(e){return ot({storeName:e,action:"clear",mode:"readwrite"})}function yt(){Ye&&Ye.close(),Ye=null}var bt="undefined"==typeof Promise?n(3).Promise:Promise;function wt(){var e,t,n=(new Date).toString();try{return(e=window.localStorage).setItem(n,n),t=e.getItem(n)===n,e.removeItem(n),!(!t||!e)}catch(e){return Y.error("LocalStorage is not supported in this browser"),!1}}function kt(){if(!wt())return{status:"error",error:{name:"LSNotSupported",message:"LocalStorage is not supported"}};var e=fe.storeNames.left,t=Oe.current||{},n=t&&!x(t);return D(e).filter(function(e){return!l()(e,2)[1].permanent}).forEach(function(r){var o=l()(r,2),i=o[0],a=o[1],u=e.activityState.name;a.name!==u||Ke.stores[u]?Ke.stores[a.name]||(Ke.stores[a.name]=[]):Ke.stores[u]=n?[De({storeName:i,record:t,dir:"left"})]:[]}),He.recover(),{status:"success"}}function Pt(e){return e.fields[e.keyPath].composite||null}function xt(e){var t=fe.right[Le({storeName:e,dir:"right"})];return Pt(t)||[t.keyPath]}function St(e,t){var n=e.storeName,r=e.id,o=e.item,i=kt(),u=fe.right[Le({storeName:n,dir:"right"})];return"error"===i.status?bt.reject(i.error):new bt(function(e,i){var s=Ke.stores[n],c=xt(n),l=r instanceof Array?r.slice():[r],f=(s[s.length-1]||{})[u.keyPath]||0,d=r?c.map(function(e,t){return[e,l[t]]}).reduce(A,{}):a()({},o),m=d?O(s,c,d):null;return t(e,i,{keys:c,items:s,index:m,options:u,lastId:f})})}function Nt(e,t,n){var r=d()(e),o=t.slice().reverse();return r.sort(function(e,t){return o.reduce(function(r,o){return r||function(e,t,r){var o=n?n===e[r]:e[r]<t[r],i=n?n>e[r]:e[r]>t[r];return o?-1:i?1:0}(e,t,o)},0)})}function Ot(e,t,n){var r=Pt(e);return r?a()(w()({},e.keyPath,r.map(function(e){return t[e]}).join("")),t):e.autoIncrement&&n?a()(w()({},e.keyPath,n),t):a()({},t)}function _t(e,t){var n=Pt(e);return n&&S(t)?n.map(function(e){return t[e]}):t[e.keyPath]||t}function jt(e,t){var n=kt();return"error"===n.status?bt.reject(n.error):new bt(function(n,r){var o=Ke.stores[e];o instanceof Array?n(t?o[0]:Nt(o,xt(e))):r({name:"NotFoundError",message:"No objectStore named ".concat(e," in this database")})})}function It(e){return jt(e,!0)}function At(e,t){return St({storeName:e,id:t},function(t,n,r){var o=r.items,i=r.index,a=r.options;-1===i?n({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(e,'" store')}):t(Ot(a,o[i]))})}function Tt(e,t){return jt(e).then(function(n){return n.filter(function(n){return n[fe.right[Le({storeName:e,dir:"right"})].index]===t})})}function Dt(e,t){return St({storeName:e,item:t},function(n,r,o){var i=o.items,a=o.index,u=o.options,s=o.lastId;-1!==a?r({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing item into "'.concat(e,'" store')}):(i.push(Ot(u,t,s+1)),Ke.stores[e]=i,n(_t(u,t)))})}function Et(e,t,n){return St({storeName:e},function(r,o,i){var a=i.keys,u=i.items,s=i.options,c=i.lastId;if(!t||t&&!t.length)return o({name:"NoTargetDefined",message:'No array provided to perform add bulk operation into "'.concat(e,'" store')});var l=c,f=t.map(function(e){return Ot(s,e,++l)}),m=f.filter(function(e){return-1!==O(u,a,e)}).map(function(e){return e[s.keyPath]}),p=n?u.filter(function(e){return-1===m.indexOf(e[s.keyPath])}):d()(u);m.length&&!n?o({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing items into "'.concat(e,'" store')}):(Ke.stores[e]=Nt([].concat(d()(p),d()(f)),a),r(t.map(function(e){return _t(s,e)})))})}function Ct(e,t){return St({storeName:e,item:t},function(n,r,o){var i=o.items,a=o.index,u=o.options,s=o.lastId,c=Ot(u,t,-1===a?s+1:null);-1===a?i.push(c):i.splice(a,1,c),Ke.stores[e]=i,n(_t(u,t))})}function Rt(e,t){return St({storeName:e,id:t},function(n,r,o){var i=o.items,a=o.index;-1!==a&&(i.splice(a,1),Ke.stores[e]=i),n(t)})}function Lt(e,t,n){return jt(e).then(function(r){var o=xt(e),i=fe.right[Le({storeName:e,dir:"right"})].index||o[0],a=Nt(r,o,n?null:t),u=function(e,t,n){if(!e.length)return-1;for(var r={index:-1,value:isNaN(n)?"":0},o=0;o<e.length;o+=1){if(!(e[o][t]<=n))return r.index;e[o][t]>=r.value&&(r={value:e[o][t],index:o})}return r.index}(a,i,t);if(-1===u)return[];var s="lowerBound"===n?u:0,c=n&&"upperBound"!==n?a.length:u+1,l=a.splice(s,c).map(function(e){return 1===o.length?e[i]:o.map(function(t){return e[t]})});return Ke.stores[e]=a,l})}function Mt(e,t){var n=kt(),r=fe.right[Le({storeName:e,dir:"right"})];return"error"===n.status?bt.reject(n.error):jt(e).then(function(e){return e.length?e[t-1]:null}).then(function(t){return t?Lt(e,t[r.keyPath],"upperBound"):[]})}function Bt(e){var t=kt();return"error"===t.status?bt.reject(t.error):bt.resolve(Ke.stores[e].length)}function qt(e){var t=kt();return"error"===t.status?bt.reject(t.error):new bt(function(t){Ke.stores[e]=[],t({})})}function Ft(){}var Kt="undefined"==typeof Promise?n(3).Promise:Promise,Gt={getAll:function(e,t){return e.getAll(t).then(function(e){return Ee({storeName:t,dir:"right",records:e})})},getFirst:function(e,t){return e.getFirst(t).then(function(e){return De({storeName:t,dir:"right",record:e})})},getItem:function(e,t,n){return e.getItem(t,Ce({storeName:t,dir:"left",target:n})).then(function(e){return De({storeName:t,dir:"right",record:e})}).catch(function(e){return Kt.reject(Me({storeName:t,error:e}))})},filterBy:function(e,t,n){return e.filterBy(t,Re(n)).then(function(e){return Ee({storeName:t,dir:"right",records:e})})},addItem:function(e,t,n){return e.addItem(t,De({storeName:t,dir:"left",record:n})).then(function(e){return Ce({storeName:t,dir:"right",target:e})}).catch(function(e){return Kt.reject(Me({storeName:t,error:e}))})},addBulk:function(e,t,n,r){return e.addBulk(t,Ee({storeName:t,dir:"left",records:n}),r).then(function(e){return e.map(function(e){return Ce({storeName:t,dir:"right",target:e})})}).catch(function(e){return Kt.reject(Me({storeName:t,error:e}))})},updateItem:function(e,t,n){return e.updateItem(t,De({storeName:t,dir:"left",record:n})).then(function(e){return Ce({storeName:t,dir:"right",target:e})})},deleteItem:function(e,t,n){return e.deleteItem(t,Ce({storeName:t,dir:"left",target:n})).then(function(e){return Ce({storeName:t,dir:"right",target:e})})},deleteBulk:function(e,t,n,r){return e.deleteBulk(t,Re(n),r).then(function(e){return e.map(function(e){return Ce({storeName:t,dir:"right",target:e})})})},trimItems:function(e,t,n){return e.trimItems(t,n)},count:function(e,t){return e.count(t)},clear:function(e,t){return e.clear(t)}};var Ut,Wt,Yt=(Xe()?(Ut=r,Wt="indexedDB"):wt()&&(Ut=o,Wt="localStorage"),Wt?a()({type:Wt,isSupported:Ut.isSupported,destroy:Ut.destroy},function(e){return D(Gt).map(function(t){var n=l()(t,2),r=n[0],o=n[1];return[r,function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return o.call.apply(o,[null,e,Le({storeName:t,dir:"left"})].concat(r))}]}).reduce(A,{})}(Ut)):(Y.error("There is no storage available, app will run with minimum set of features"),null));function Ht(){return Yt.getAll("queue").then(function(e){return{queueSize:e.length}}).then(function(e){return a()({},{createdAt:me()},{},{sentAt:me()},{},{webUuid:Oe.current.uuid},{},(u=void 0!==navigator.doNotTrack,s=void 0!==window.doNotTrack,c=void 0!==navigator.msDoNotTrack,f=u?navigator.doNotTrack:s?window.doNotTrack:c?navigator.msDoNotTrack:null,0===parseInt(f,10)||"no"===f?{trackingEnabled:!0}:1===parseInt(f,10)||"yes"===f?{trackingEnabled:!1}:{}),{},{platform:"web"},{},(n=(navigator.language||navigator.userLanguage||"en").split("-"),r=l()(n,2),o=r[0],i=r[1],{language:o,country:i?""+i.toLowerCase():void 0}),{},(t=navigator.userAgent||navigator.vendor,{machineType:("Win32"!==navigator.platform||-1===t.indexOf("WOW64")&&-1===t.indexOf("Win64")?navigator.platform:"Win64")||void 0}),{},e);var t,n,r,o,i,u,s,c,f})}var Jt="undefined"==typeof Promise?n(3).Promise:Promise,zt={TRANSACTION_ERROR:"XHR transaction failed due to an error",SERVER_MALFORMED_RESPONSE:"Response from server is malformed",NO_CONNECTION:"No internet connectivity"};function Vt(e,t){var n={action:"RETRY",message:zt[t],code:t};return{status:e.status,statusText:e.statusText,response:n,responseText:JSON.stringify(n)}}function Xt(e,t,n){var r=n.xhr,o=n.url;4===r.readyState&&(r.status>=200&&r.status<300?N(r.response)?t(function(e,t){var n=JSON.parse(e.response),r=I(t,"attribution")?["attribution","message"]:[];return["adid","timestamp","ask_in","retry_in","tracking_state"].concat(r).filter(function(e){return n[e]}).reduce(function(e,t){return a()({},e,w()({},t,n[t]))},{})}(r,o)):e(Vt(r,"SERVER_MALFORMED_RESPONSE")):0===r.status?e(Vt(r,"NO_CONNECTION")):t(function(e){return N(e.response)?{response:JSON.parse(e.response),message:"Error from server",code:"SERVER_ERROR"}:{message:"Unknown error from server",code:"SERVER_UNKNOWN_ERROR"}}(r)))}function Zt(e,t,n,r){var o=function(e,t){return D(e=a()({},ee.getBaseParams(),{},t,{},e)).filter(function(e){var t=l()(e,2)[1];return S(t)?!x(t):!!t||0===t}).map(function(e){return e.map(function(e,t){return 0===t&&(e=e.replace(/([A-Z])/g,function(e){return"_".concat(e.toLowerCase())})),S(e)&&(e=JSON.stringify(e)),encodeURIComponent(e)}).join("=")}).join("&")}(n,r),i="/gdpr_forget_device"===e?"gdpr":"app";return{fullUrl:(ee.getCustomConfig().customUrl||ee.baseUrl[i])+e+("GET"===t?"?".concat(o):""),encodedParams:o}}function $t(e){return Ht().then(function(t){return function(e){var t=e.url,n=e.method,r=void 0===n?"GET":n,o=e.params,i=void 0===o?{}:o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=Zt(t,r,i,a),s=u.fullUrl,c=u.encodedParams;return new Jt(function(e,n){var o=new XMLHttpRequest;o.open(r,s,!0),o.setRequestHeader("Client-SDK","js".concat(ee.version)),"POST"===r&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){return Xt(n,e,{xhr:o,url:t})},o.onerror=function(){return n(Vt(o,"TRANSACTION_ERROR"))},o.send("GET"===r?void 0:c)})}(e,t)}).then(function(t){return function(e,t){var n=I(t.url,"gdpr_forget_device"),r=I(t.url,"attribution"),o=I(t.url,"session"),i="opted_out"===e.tracking_state;return!n&&i?(Ae("sdk:gdpr-forget-me",!0),e):(r||n||i||!e.ask_in||Ae("attribution:check",e),o&&Ae("session:finished"),e)}(t,e)})}var Qt={long:{delay:2*p,maxDelay:h,minRange:.5,maxRange:1},short:{delay:200,maxDelay:v,minRange:.5,maxRange:1},test:{delay:100,maxDelay:300}};function en(e,t){var n,r,o=Qt[t=t||"long"],i=o.delay*Math.pow(2,e-1);return i=Math.min(i,o.maxDelay),o.minRange&&o.maxRange&&(i*=(n=o.minRange,r=o.maxRange,Math.random()*(r-n)+n)),Math.round(i)}var tn=navigator.onLine;function nn(){tn=!0}function rn(){tn=!1}function on(e,t,n){e.addEventListener&&e.addEventListener(t,n,!1)}function an(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}function un(){return tn}var sn="undefined"==typeof Promise?n(3).Promise:Promise,cn=0,ln=150,fn=2147483647,dn=60*m,mn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.method,r=void 0===n?"GET":n,o=e.params,i=void 0===o?{}:o,u=e.continueCb,s=e.strategy,c=e.wait,l={url:t,method:r,params:i,continueCb:u},f=t,d=r,m=a()({},i),p=u,v=s,h=null,g={request:cn,connection:cn},y=w(c),b=null;function w(e){return(e=e||ln)>fn?fn:e}function k(e){var t=e.url,n=e.method,r=e.params,o=e.continueCb;t&&(f=t),n&&(d=n),x(r)||(m=a()({},r)),m=a()({createdAt:me()},m),"function"==typeof o&&(p=o)}function P(e){if(!b)return!1;if(h){var t=y-(Date.now()-b);if(e&&t<e)return!0;R()}return!1}function S(e){var t=e.wait,n=e.retrying;return y=t?w(t):y,P(t)?sn.resolve({}):f?(Y.log("".concat(n?"Re-trying":"Trying"," request ").concat(f," in ").concat(y,"ms")),b=Date.now(),N()):(Y.error("You must define url for the request to be sent"),sn.reject({error:"No url specified"}))}function N(){return C(),un()?O():(g.connection+=1,Y.log("No internet connectivity, trying request ".concat(f||"unknown"," in ").concat(dn,"ms")),new sn(function(e){h=setTimeout(function(){e(N())},dn)}))}function O(){return new sn(function(e,t){h=setTimeout(function(){return b=null,$t({url:f,method:d,params:a()({attempts:(g.request?g.request+1:1)+g.connection},m)}).then(function(t){return A(t,e)}).catch(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.response,o=void 0===r?{}:r;return T(o,e,t)})},y)})}function _(){f=l.url,d=l.method,m=a()({},l.params),p=l.continueCb}function j(e){Y.log("Request ".concat(f||"unknown"," ").concat(e?"failed":"has been finished")),g.request=cn,g.connection=cn,y=ln,_(),R()}function I(e){return g.request+=1,R(),S({wait:e||en(g.request,v),retrying:!0})}function A(e,t){(e=e||{}).retry_in?t(I(e.retry_in)):("function"==typeof p?p(e,j,I):j(),t(e))}function T(e,t,n){"RETRY"!==e.action?(j(!0),n(e)):t(I("NO_CONNECTION"===e.code?dn:void 0))}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.method,r=e.params,o=void 0===r?{}:r,i=e.continueCb,a=e.wait;return k({url:t,method:n,params:o,continueCb:i}),S({wait:a})}function E(){return!!h}function C(){h&&clearTimeout(h),h=null}function R(){var e=!!b;C(),b=null,e&&(y=ln,g.request=cn,g.connection=cn,Y.log("Previous ".concat(f||"unknown"," request attempt canceled")),_())}return{send:D,isRunning:E,clear:R}},pn="undefined"==typeof Promise?n(3).Promise:Promise,vn="activityState",hn=!1;function gn(e){return e?"unknown"===e.uuid?(wn({reason:y}),Oe.destroy(),{exists:!0,stored:null}):(Oe.init(e),{exists:!0,stored:e}):{exists:!1}}function yn(){return"off"!==kn()&&Oe.isStarted()}function bn(){if(!yn())return pn.resolve(null);var e=a()({},Oe.current,{lastActive:Date.now()});return Yt.updateItem(vn,e).then(function(){return Oe.current=e})}function wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reason,n=e.pending,r=void 0!==n&&n,o=function(e){return e===y?" due to GDPR-Forget-Me request":""},i=He.disabled||{};return i.reason?(Y.log("Adjust SDK is already disabled"+o(i.reason)),!1):(Y.log("Adjust SDK has been disabled"+o(t)),He.disabled={reason:t||g,pending:r},!0)}function kn(){var e=He.disabled||{};return e.reason===g||e.reason===y&&!e.pending?"off":e.reason===y&&e.pending?"paused":"on"}var Pn="undefined"==typeof Promise?n(3).Promise:Promise,xn=mn({strategy:"long",continueCb:function(e,t){var n=e&&e.continue_in||null;return On.pause=n?{timestamp:Date.now(),wait:n}:null,Yt.getFirst(Nn).then(function(e){return e?Yt.deleteItem(Nn,e.timestamp):null}).then(function(){return t(),On.running=!1,In({wait:n})})}}),Sn=!1,Nn="queue",On={running:!1,timestamp:null,pause:null};function _n(e,t){var n=e.url,r=e.method,o=e.params;Oe.updateParams(n,t),o=function(e,t){var n=I(e,"event")?{eventCount:Oe.current.eventCount}:{};return a()({},n,{},Oe.getParams(),{},t)}(n,o);var i,u={timestamp:(i=Date.now(),i<=On.timestamp&&(i=On.timestamp+1),On.timestamp=i,i),url:n,method:r,params:o};return Yt.addItem(Nn,u).then(function(){return function(e){return I(e,"session")&&Oe.resetSessionOffset(),Oe.updateLastActive(),bn()}(n)}).then(function(){return On.running?{}:In()})}function jn(){if(!On.pause)return null;var e=Date.now()-On.pause.timestamp;return e<On.pause.wait?On.pause.wait-e:null}function In(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cleanUp,n=e.wait;On.running=!0;var r=Pn.resolve({});return t&&(r=r.then(Tn)),r.then(function(){return Yt.getFirst(Nn)}).then(function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timestamp,n=e.url,r=e.method,o=e.params,i=arguments.length>1?arguments[1]:void 0,u=Oe.current||{},s="/session"===n&&!u.attribution;return Sn&&!s||!n&&!r&&!o?(On.running=!1,Pn.resolve({})):xn.send({url:n,method:r,params:a()({},o,{createdAt:me(t)}),wait:i||jn()})}(e,n)})}function An(e){if(void 0!==e)if(e!==Sn){var t=Sn;Sn=e,!e&&t&&In(),Y.info("The app is now in ".concat(e?"offline":"online"," mode"))}else Y.error("The app is already in ".concat(e?"offline":"online"," mode"));else Y.error("State not provided, true or false has to be defined")}function Tn(){var e=Date.now()-ee.requestValidityWindow;return Yt.deleteBulk(Nn,e,"upperBound")}var Dn="undefined"==typeof Promise?n(3).Promise:Promise,En="globalParams",Cn={short:"No type provided",long:"Global parameter type not provided, `callback` or `partner` types are available"};function Rn(e){return(e||[]).map(function(e){return{key:e.key,value:e.value}})}function Ln(){return Dn.all([Yt.filterBy(En,"callback"),Yt.filterBy(En,"partner")]).then(function(e){var t=l()(e,2),n=t[0],r=t[1];return{callbackParams:Rn(n),partnerParams:Rn(r)}})}function Mn(e,t){if(void 0===t)return Y.error(Cn.long),Dn.reject({message:Cn.short});var n=_(e),r=Object.keys(n).map(function(e){return{key:e,value:n[e],type:t}});return Dn.all([Yt.filterBy(En,t),Yt.addBulk(En,r,!0)]).then(function(e){var n=l()(e,2),o=n[0],i=n[1],a=j(o.map(function(e){return e.key}),i.map(function(e){return e[0]}));return Y.log("Following ".concat(t," parameters have been saved: ").concat(r.map(function(e){return"".concat(e.key,":").concat(e.value)}).join(", "))),a.length&&Y.log("Keys: ".concat(a.join(", ")," already existed so their values have been updated")),i})}function Bn(e,t){return void 0===t?(Y.error(Cn.long),Dn.reject({message:Cn.short})):Yt.deleteItem(En,[e,t]).then(function(n){return Y.log("".concat(e," ").concat(t," parameter has been deleted")),n})}function qn(e){return void 0===e?(Y.error(Cn.long),Dn.reject({message:Cn.short})):Yt.deleteBulk(En,e).then(function(t){return Y.log("All ".concat(e," parameters have been deleted")),t})}var Fn,Kn,Gn,Un=!1;function Wn(){if(Gn=function(){if(void 0!==document.hidden)return{hidden:"hidden",visibilityChange:"visibilitychange"};for(var e=D({mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange",webkitHidden:"webkitvisibilitychange"}),t=0;t<e.length;t+=1){var n=l()(e[t],2),r=n[0],o=n[1];if(void 0!==document[r])return{hidden:r,visibilityChange:o}}return null}(),Un)Y.error("Session watch already initiated");else if(Un=!0,Ie("session:finished",zn),Gn&&on(document,Gn.visibilityChange,Jn),!Gn||!document[Gn.hidden])return Oe.initParams(),Xn()}function Yn(){return Vn(),Oe.updateSessionOffset(),Oe.toBackground(),bn()}function Hn(){return Oe.updateSessionLength(),Oe.toForeground(),Yt.getFirst(vn).then(function(e){var t=Oe.current.lastActive||0;return yn()&&t<e.lastActive&&(Oe.current=e,He.reload()),e}).then(Xn)}function Jn(){clearTimeout(Kn);var e=document[Gn.hidden]?Yn:Hn;Kn=setTimeout(e,0)}function zn(){return Oe.updateInstalled(),bn()}function Vn(){clearInterval(Fn)}function Xn(){Vn(),Fn=setInterval(function(){return Oe.updateSessionOffset(),bn()},ee.sessionTimerWindow);var e=Oe.current,t=e.lastInterval,n=e.installed;return!n||n&&t*m>=ee.sessionWindow?Ln().then(function(e){var t,n,r,o=e.callbackParams,i=e.partnerParams;_n({url:"/session",method:"POST",params:(t=o,n=i,r={},t.length&&(r.callbackParams=_(t)),n.length&&(r.partnerParams=_(n)),r)},!0)}):(Ae("attribution:check"),bn())}var Zn="undefined"==typeof Promise?n(3).Promise:Promise,$n=mn({url:"/attribution",strategy:"short",continueCb:function(e,t,n){if(!(e=e||{}).ask_in)return t(),function(e){if(x(e)||!function(e){var t=e.adid,n=void 0===t?"":t,r=e.attribution,o=void 0===r?{}:r;return!!n&&!!j(Qn,Object.keys(o)).length}(e)||function(e){var t=e.adid,n=e.attribution,r=Oe.current.attribution||{};return!Qn.some(function(e){return r[e]!==n[e]})&&t===r.adid}(e))return Zn.resolve({state:"same"});var t=D(e.attribution).filter(function(e){var t=l()(e,1)[0];return-1!==Qn.indexOf(t)}).reduce(A,{adid:e.adid});return Oe.current=a()({},Oe.current,{attribution:t}),bn().then(function(){return Ae("attribution:change",t),Y.info("Attribution has been updated"),{state:"changed"}})}(e);return n(e.ask_in)}}),Qn=["tracker_token","tracker_name","network","campaign","adgroup","creative","click_label","state"];var er=mn({url:"/gdpr_forget_device",method:"POST",strategy:"short"}),tr={running:"Adjust SDK is running pending GDPR Forget Me request",pending:"Adjust SDK will run GDPR Forget Me request after initialisation",paused:"Adjust SDK is already prepared to send GDPR Forget Me request",off:"Adjust SDK is already disabled"};function nr(e){var t=kn();return e||"on"===t?ee.isInitialised()?(er.send({params:Oe.getParams()}).then(function(){Ae("sdk:gdpr-forget-me",!0)}),!0):(Y.log(tr.pending),!0):(Y.log(tr[t]),!1)}var rr="undefined"==typeof Promise?n(3).Promise:Promise,or=10,ir="eventDeduplication";function ar(e,t){var n,r,o=t.callbackParams,i=t.partnerParams,u={},s=a()({eventToken:e.eventToken},(n=e.revenue,r=e.currency,isNaN(n)?{}:(n=parseFloat(n))<0||!r?{}:{revenue:n.toFixed(5),currency:r})),c=a()({},_(o),{},_(e.callbackParams)),l=a()({},_(i),{},_(e.partnerParams));return x(c)||(u.callbackParams=c),x(l)||(u.partnerParams=l),a()({},s,{},u)}function ur(e){return e?Yt.getAll(ir).then(function(e){return e.map(function(e){return e.id})}).then(function(t){return-1===t.indexOf(e)?function(e){var t=ee.getCustomConfig().eventDeduplicationListLimit||or;return Yt.count(ir).then(function(e){var n=rr.resolve();if(e>=t){var r=e-t+1;Y.log("Event deduplication list limit has been reached. Oldest ids are about to be removed (".concat(r," of them)")),n=Yt.trimItems(ir,r)}return n}).then(function(){return Y.info("New event deduplication id is added to the list: ".concat(e)),Yt.addItem(ir,{id:e})})}(e):rr.reject({message:"Event won't be tracked, since it was previously tracked with the same deduplication id ".concat(e)})}):rr.resolve()}function sr(){var e=window.location.search.substring(1).split("&").map(function(e){return e.split("=")}).reduce(A,{}).adjust_referrer;e&&_n({url:"/sdk_click",method:"POST",params:{clickTime:me(),source:"web_referrer",referrer:decodeURIComponent(e)}})}var cr="undefined"==typeof Promise?n(3).Promise:Promise,lr=null,fr=!1;function dr(){var e;"paused"===kn()&&cr.all([(e={uuid:"unknown"},Oe.current=e,He.disabled={reason:y,pending:!1},Yt.clear(vn).then(function(){return Yt.addItem(vn,e)})),Yt.clear(En),Yt.clear(Nn)]).then(vr)}function mr(){fr=!1,xn.clear(),On.running=!1,On.timestamp=null,On.pause=null,Un=!1,Oe.toBackground(),Vn(),Gn&&(clearTimeout(Kn),an(document,Gn.visibilityChange,Jn)),$n.clear()}function pr(e){e&&Y.log("Adjust SDK has been shutdown due to asynchronous disable"),mr(),je.forEach(clearTimeout),je=[],_e={},Oe.destroy(),an(window,"online",nn),an(window,"offline",rn),Yt.destroy(),ee.destroy()}function vr(){pr(),er.clear(),lr=null,Y.log("Adjust SDK instance has been destroyed")}function hr(){"paused"===kn()&&(Y.log(tr.running),nr(!0));var e=kn(),t=function(e){return"Adjust SDK start has been interrupted ".concat(e)};return"off"===e?(pr(),cr.reject({message:t("due to complete async disable")})):"paused"===e?(mr(),cr.reject({message:t("due to partial async disable")})):fr?cr.reject({message:t("due to multiple synchronous start attempt")}):(fr=!0,In({cleanUp:!0}),Wn())}function gr(e){"off"!==kn()?(ee.set(e),on(window,"online",nn),on(window,"offline",rn),Ie("sdk:shutdown",function(){return pr(!0)}),Ie("sdk:gdpr-forget-me",dr),Ie("attribution:check",function(e,t){return n=t,r=Oe.current,(o=(n||{}).ask_in)||!r.attribution&&r.installed?($n.send({params:a()({initiatedBy:n?"backend":"sdk"},Oe.getParams()),wait:o}),Oe.updateSessionOffset(),bn()):Zn.resolve(r);var n,r,o}),"function"==typeof e.attributionCallback&&Ie("attribution:change",e.attributionCallback),(hn?pn.reject({message:"Adjust SDK start already in progress"}):(hn=!0,Yt.getFirst(vn).then(gn).then(function(e){if(e.exists)return hn=!1,e.stored;var t,n=x(Oe.current)?{uuid:(t=Date.now(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:11&n).toString(16)}))}:Oe.current;return Yt.addItem(vn,n).then(function(){return Oe.init(n),He.reload(),hn=!1,n})}))).then(hr).then(sr).catch(function(e){e&&e.message?Y.log(e.message):(pr(),Y.error("Adjust SDK start has been canceled due to an error",e))})):Y.log("Adjust SDK is disabled, can not start the sdk")}function yr(e,t){Yt?"on"===kn()?"function"==typeof t&&t():Y.log("Adjust SDK is disabled, can not ".concat(e)):Y.log("Adjust SDK can not ".concat(e,", no storage available"))}var br={initSdk:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.logLevel,n=e.logOutput,r=s()(e,["logLevel","logOutput"]);Y.setLogLevel(t,n),Yt?(Y.info("Available storage is ".concat(Yt.type)),ee.isInitialised()?Y.error("You already initiated your instance"):ee.hasMissing(r)||(lr=a()({},r),gr(r))):Y.error("Adjust SDK can not start, there is no storage available")},trackEvent:function(e){yr("track event",function(){return function(e){if(ee.isInitialised()){if(e&&(!e||!x(e)&&e.eventToken))return ur(e.deduplicationId).then(Ln).then(function(t){_n({url:"/event",method:"POST",params:ar(e,t)})}).catch(function(e){e&&e.message&&Y.error(e.message)});Y.error("You must provide event token in order to track event")}else Y.error("Adjust SDK is not initiated, can not track event")}(e)})},addGlobalCallbackParameters:function(e){yr("add global callback parameters",function(){return Mn(e,"callback")})},addGlobalPartnerParameters:function(e){yr("add global partner parameters",function(){return Mn(e,"partner")})},removeGlobalCallbackParameter:function(e){yr("remove global callback parameter",function(){return Bn(e,"callback")})},removePartnerCallbackParameter:function(e){yr("remove global partner parameter",function(){return Bn(e,"partner")})},clearGlobalCallbackParameters:function(){yr("remove all global callback parameters",function(){return qn("callback")})},clearGlobalPartnerParameters:function(){yr("remove all global partner parameters",function(){return qn("partner")})},switchToOfflineMode:function(){yr("set offline mode",function(){return An(!0)})},switchBackToOnlineMode:function(){yr("set online mode",function(){return An(!1)})},stop:function(){wn()&&ee.isInitialised()&&pr()},restart:function(){var e;((e=He.disabled||{}).reason===y?(Y.log("Adjust SDK is disabled due to GDPR-Forget-Me request and it can not be re-enabled"),!1):e.reason?(Y.log("Adjust SDK has been enabled"),He.disabled=null,!0):(Y.log("Adjust SDK is already enabled"),!1))&&lr&&gr(lr)},gdprForgetMe:function(){var e=nr();e&&(e=wn({reason:y,pending:!0}))&&ee.isInitialised()&&mr()},__testonly__:{destroy:vr}};t.default=br}]).default});